---
title: "R Notebook"
output: html_notebook
---

```{r}
library(readxl)
library(caret)
library(boot)
library('tree')
library(class)
library(glmnet)
library(zoo)
library(randomForest)

set.seed(100)
curr_spot_rates <- read_excel("FX.xlsx", sheet = 1)[1:413,]
curr_interest <- read_excel("FX.xlsx", sheet = 2)[1:413,]
curr_moneysupp <- read_excel("FX.xlsx", sheet = 3)[1:413,]
curr_ip <- read_excel("FX.xlsx", sheet = 4)[1:413,]
curr_cpi <- read_excel("FX.xlsx", sheet = 5)[1:413,]


#calc for Y
curr_spot_rates_delta <- curr_spot_rates
curr_spot_rates_delta[1, 2:10] <- 0

for (j in 2:length(curr_spot_rates)){
  for (i in 2:nrow(curr_spot_rates)){
    curr_spot_rates_delta [i, j]<- (log(curr_spot_rates[i, j]) - log(curr_spot_rates[i-1, j]))
}}


#calc for X1
curr_interest_delta <-curr_interest
for (j in 2:length(curr_interest)){
  for (i in 1:nrow(curr_interest)){
    curr_interest_delta [i,j]<- (curr_interest[i,j]-curr_interest[i,11])
}}

#calc for X2
curr_cpi_delta <-curr_cpi
for (j in 2:length(curr_cpi)){
  for (i in 2:nrow(curr_cpi)){
    curr_cpi_delta [i,j]<-(log(curr_cpi[i,j])-log(curr_cpi[i-1,j])- (log(curr_cpi[i,11])-log(curr_cpi[i-1,11])))
}}

#calc for X3
curr_ip_delta <-curr_ip
for (j in 2:length(curr_ip)){
  for (i in 1:nrow(curr_ip)){
    curr_ip_delta [i,j]<- (log(curr_ip[i,j])- log(curr_ip[i,11]))
}}

#calc for X4
curr_moneysupp_delta <-curr_moneysupp
for (j in 2:length(curr_moneysupp)){
  for (i in 1:nrow(curr_moneysupp)){
    curr_moneysupp_delta [i,j]<- (log(curr_moneysupp[i,j])- log(curr_moneysupp[i,11]))
}}

# Risk free Return data
risk_free_return <- read_excel("Risk free Returns.xls")
risk_free_return$percent <- (risk_free_return$rate/100)/12

# Additional Data
gdp <- read_excel("Additional Data v2.xlsx", sheet = 1)
debt <- read_excel("Additional Data v2.xlsx", sheet = 2)
equity <- read_excel("Additional Data v2.xlsx", sheet = 3)

  
AUD <- data.frame(curr_spot_rates$Date, curr_spot_rates$AUD, curr_spot_rates_delta$AUD,  curr_interest_delta$AUD, curr_moneysupp_delta$AUD, curr_ip_delta$AUD, curr_cpi_delta$AUD, gdp$AUD, debt$AUD, equity$AUD)

CAD <- data.frame(curr_spot_rates$Date, curr_spot_rates$CAD, curr_spot_rates_delta$CAD,  curr_interest_delta$CAD, curr_moneysupp_delta$CAD, curr_ip_delta$CAD, curr_cpi_delta$CAD, gdp$CAD, debt$CAD, equity$CAD)

CHF <- data.frame(curr_spot_rates$Date, curr_spot_rates$CHF, curr_spot_rates_delta$CHF,  curr_interest_delta$CHF, curr_moneysupp_delta$CHF, curr_ip_delta$CHF, curr_cpi_delta$CHF, gdp$CHF, debt$CHF, equity$CHF)

EUR <- data.frame(curr_spot_rates$Date, curr_spot_rates$EUR, curr_spot_rates_delta$EUR,  curr_interest_delta$EUR, curr_moneysupp_delta$EUR, curr_ip_delta$EUR, curr_cpi_delta$EUR, gdp$EUR, debt$EUR, equity$EUR)

GBP <- data.frame(curr_spot_rates$Date, curr_spot_rates$GBP, curr_spot_rates_delta$GBP,  curr_interest_delta$GBP, curr_moneysupp_delta$GBP, curr_ip_delta$GBP, curr_cpi_delta$GBP, gdp$GBP, debt$GBP, equity$GBP)

JPY <- data.frame(curr_spot_rates$Date, curr_spot_rates$JPY, curr_spot_rates_delta$JPY,  curr_interest_delta$JPY, curr_moneysupp_delta$JPY, curr_ip_delta$JPY, curr_cpi_delta$JPY, gdp$JPY, debt$JPY, equity$JPY)

NOK <- data.frame(curr_spot_rates$Date, curr_spot_rates$NOK, curr_spot_rates_delta$NOK,  curr_interest_delta$NOK, curr_moneysupp_delta$NOK, curr_ip_delta$NOK, curr_cpi_delta$NOK, gdp$NOK, debt$NOK, equity$NOK)

NZD <- data.frame(curr_spot_rates$Date, curr_spot_rates$NZD, curr_spot_rates_delta$NZD,  curr_interest_delta$NZD, curr_moneysupp_delta$NZD, curr_ip_delta$NZD, curr_cpi_delta$NZD, gdp$NZD, debt$NZD, equity$NZD)

SEK <- data.frame(curr_spot_rates$Date, curr_spot_rates$SEK, curr_spot_rates_delta$SEK,  curr_interest_delta$SEK, curr_moneysupp_delta$SEK, curr_ip_delta$SEK, curr_cpi_delta$SEK, gdp$SEK, debt$SEK, equity$SEK)

w1 <- 36
w2 <- 60
w3 <- 120
w4 <- 240
w5 <- 180

rhm1 <- data.frame(row.names = 1:378)
rhm2 <- data.frame(row.names = 1:354)
rhm3 <- data.frame(row.names = 1:294)
rhm4 <- data.frame(row.names = 1:174)
rhm5 <- data.frame(row.names = 1:234)


CumRSME <- data.frame(row.names = c(w1, w2, w3, w4, w5))


rhm1$AUD_mean <- rollapply(zoo(AUD$curr_spot_rates_delta.AUD), width = w1, FUN = mean, na.rm = TRUE, align = "left")
rhm1$AUD_sd <- rollapply(zoo(AUD$curr_spot_rates_delta.AUD), width = w1, FUN = sd, na.rm = TRUE, align = "left")
rhm1$AUD_SME <- (rhm1$AUD_mean - subset(AUD$curr_spot_rates_delta.AUD, AUD$curr_spot_rates.Date > 197812))^2
CumRSME$AUD[1] <- sqrt(sum(rhm1$AUD_SME)/378)

rhm2$AUD_mean <- rollapply(zoo(AUD$curr_spot_rates_delta.AUD), width = w2, FUN = mean, na.rm = TRUE, align = "left")
rhm2$AUD_sd <- rollapply(zoo(AUD$curr_spot_rates_delta.AUD), width = w2, FUN = sd, na.rm = TRUE, align = "left")
rhm2$AUD_SME <- (rhm2$AUD_mean - subset(AUD$curr_spot_rates_delta.AUD, AUD$curr_spot_rates.Date > 198012))^2
CumRSME$AUD[2] <- sqrt(sum(rhm2$AUD_SME)/354)

rhm3$AUD_mean <- rollapply(zoo(AUD$curr_spot_rates_delta.AUD), width = w3, FUN = mean, na.rm = TRUE, align = "left")
rhm3$AUD_sd <- rollapply(zoo(AUD$curr_spot_rates_delta.AUD), width = w3, FUN = sd, na.rm = TRUE, align = "left")
rhm3$AUD_SME <- (rhm3$AUD_mean - subset(AUD$curr_spot_rates_delta.AUD, AUD$curr_spot_rates.Date > 198512))^2
CumRSME$AUD[3] <- sqrt(sum(rhm3$AUD_SME)/294)

rhm4$AUD_mean <- rollapply(zoo(AUD$curr_spot_rates_delta.AUD), width = w4, FUN = mean, na.rm = TRUE, align = "left")
rhm4$AUD_sd <- rollapply(zoo(AUD$curr_spot_rates_delta.AUD), width = w4, FUN = sd, na.rm = TRUE, align = "left")
rhm4$AUD_SME <- (rhm4$AUD_mean - subset(AUD$curr_spot_rates_delta.AUD, AUD$curr_spot_rates.Date > 199512))^2
CumRSME$AUD[4] <- sqrt(sum(rhm4$AUD_SME)/174)

rhm5$AUD_mean <- rollapply(zoo(AUD$curr_spot_rates_delta.AUD), width = w5, FUN = mean, na.rm = TRUE, align = "left")
rhm5$AUD_sd <- rollapply(zoo(AUD$curr_spot_rates_delta.AUD), width = w5, FUN = sd, na.rm = TRUE, align = "left")
rhm5$AUD_SME <- (rhm5$AUD_mean - subset(AUD$curr_spot_rates_delta.AUD, AUD$curr_spot_rates.Date > 199012))^2
CumRSME$AUD[5] <- sqrt(sum(rhm5$AUD_SME)/234)



rhm1$CAD_mean <- rollapply(zoo(CAD$curr_spot_rates_delta.CAD), width = w1, FUN = mean, na.rm = TRUE, align = "left")
rhm1$CAD_sd <- rollapply(zoo(CAD$curr_spot_rates_delta.CAD), width = w1, FUN = sd, na.rm = TRUE, align = "left")
rhm1$CAD_SME <- (rhm1$CAD_mean - subset(CAD$curr_spot_rates_delta.CAD, CAD$curr_spot_rates.Date > 197812))^2
CumRSME$CAD[1] <- sqrt(sum(rhm1$CAD_SME)/378)

rhm2$CAD_mean <- rollapply(zoo(CAD$curr_spot_rates_delta.CAD), width = w2, FUN = mean, na.rm = TRUE, align = "left")
rhm2$CAD_sd <- rollapply(zoo(CAD$curr_spot_rates_delta.CAD), width = w2, FUN = sd, na.rm = TRUE, align = "left")
rhm2$CAD_SME <- (rhm2$CAD_mean - subset(CAD$curr_spot_rates_delta.CAD, CAD$curr_spot_rates.Date > 198012))^2
CumRSME$CAD[2] <- sqrt(sum(rhm2$CAD_SME)/354)

rhm3$CAD_mean <- rollapply(zoo(CAD$curr_spot_rates_delta.CAD), width = w3, FUN = mean, na.rm = TRUE, align = "left")
rhm3$CAD_sd <- rollapply(zoo(CAD$curr_spot_rates_delta.CAD), width = w3, FUN = sd, na.rm = TRUE, align = "left")
rhm3$CAD_SME <- (rhm3$CAD_mean - subset(CAD$curr_spot_rates_delta.CAD, CAD$curr_spot_rates.Date > 198512))^2
CumRSME$CAD[3] <- sqrt(sum(rhm3$CAD_SME)/294)

rhm4$CAD_mean <- rollapply(zoo(CAD$curr_spot_rates_delta.CAD), width = w4, FUN = mean, na.rm = TRUE, align = "left")
rhm4$CAD_sd <- rollapply(zoo(CAD$curr_spot_rates_delta.CAD), width = w4, FUN = sd, na.rm = TRUE, align = "left")
rhm4$CAD_SME <- (rhm4$CAD_mean - subset(CAD$curr_spot_rates_delta.CAD, CAD$curr_spot_rates.Date > 199512))^2
CumRSME$CAD[4] <- sqrt(sum(rhm4$CAD_SME)/174)

rhm5$CAD_mean <- rollapply(zoo(CAD$curr_spot_rates_delta.CAD), width = w5, FUN = mean, na.rm = TRUE, align = "left")
rhm5$CAD_sd <- rollapply(zoo(CAD$curr_spot_rates_delta.CAD), width = w5, FUN = sd, na.rm = TRUE, align = "left")
rhm5$CAD_SME <- (rhm5$CAD_mean - subset(CAD$curr_spot_rates_delta.CAD, CAD$curr_spot_rates.Date > 199012))^2
CumRSME$CAD[5] <- sqrt(sum(rhm5$CAD_SME)/234)




rhm1$CHF_mean <- rollapply(zoo(CHF$curr_spot_rates_delta.CHF), width = w1, FUN = mean, na.rm = TRUE, align = "left")
rhm1$CHF_sd <- rollapply(zoo(CHF$curr_spot_rates_delta.CHF), width = w1, FUN = sd, na.rm = TRUE, align = "left")
rhm1$CHF_SME <- (rhm1$CHF_mean - subset(CHF$curr_spot_rates_delta.CHF, CHF$curr_spot_rates.Date > 197812))^2
CumRSME$CHF[1] <- sqrt(sum(rhm1$CHF_SME)/378)

rhm2$CHF_mean <- rollapply(zoo(CHF$curr_spot_rates_delta.CHF), width = w2, FUN = mean, na.rm = TRUE, align = "left")
rhm2$CHF_sd <- rollapply(zoo(CHF$curr_spot_rates_delta.CHF), width = w2, FUN = sd, na.rm = TRUE, align = "left")
rhm2$CHF_SME <- (rhm2$CHF_mean - subset(CHF$curr_spot_rates_delta.CHF, CHF$curr_spot_rates.Date > 198012))^2
CumRSME$CHF[2] <- sqrt(sum(rhm2$CHF_SME)/354)

rhm3$CHF_mean <- rollapply(zoo(CHF$curr_spot_rates_delta.CHF), width = w3, FUN = mean, na.rm = TRUE, align = "left")
rhm3$CHF_sd <- rollapply(zoo(CHF$curr_spot_rates_delta.CHF), width = w3, FUN = sd, na.rm = TRUE, align = "left")
rhm3$CHF_SME <- (rhm3$CHF_mean - subset(CHF$curr_spot_rates_delta.CHF, CHF$curr_spot_rates.Date > 198512))^2
CumRSME$CHF[3] <- sqrt(sum(rhm3$CHF_SME)/294)

rhm4$CHF_mean <- rollapply(zoo(CHF$curr_spot_rates_delta.CHF), width = w4, FUN = mean, na.rm = TRUE, align = "left")
rhm4$CHF_sd <- rollapply(zoo(CHF$curr_spot_rates_delta.CHF), width = w4, FUN = sd, na.rm = TRUE, align = "left")
rhm4$CHF_SME <- (rhm4$CHF_mean - subset(CHF$curr_spot_rates_delta.CHF, CHF$curr_spot_rates.Date > 199512))^2
CumRSME$CHF[4] <- sqrt(sum(rhm4$CHF_SME)/174)

rhm5$CHF_mean <- rollapply(zoo(CHF$curr_spot_rates_delta.CHF), width = w5, FUN = mean, na.rm = TRUE, align = "left")
rhm5$CHF_sd <- rollapply(zoo(CHF$curr_spot_rates_delta.CHF), width = w5, FUN = sd, na.rm = TRUE, align = "left")
rhm5$CHF_SME <- (rhm5$CHF_mean - subset(CHF$curr_spot_rates_delta.CHF, CHF$curr_spot_rates.Date > 199012))^2
CumRSME$CHF[5] <- sqrt(sum(rhm5$CHF_SME)/234)




rhm1$EUR_mean <- rollapply(zoo(EUR$curr_spot_rates_delta.EUR), width = w1, FUN = mean, na.rm = TRUE, align = "left")
rhm1$EUR_sd <- rollapply(zoo(EUR$curr_spot_rates_delta.EUR), width = w1, FUN = sd, na.rm = TRUE, align = "left")
rhm1$EUR_SME <- (rhm1$EUR_mean - subset(EUR$curr_spot_rates_delta.EUR, EUR$curr_spot_rates.Date > 197812))^2
CumRSME$EUR[1] <- sqrt(sum(rhm1$EUR_SME)/378)

rhm2$EUR_mean <- rollapply(zoo(EUR$curr_spot_rates_delta.EUR), width = w2, FUN = mean, na.rm = TRUE, align = "left")
rhm2$EUR_sd <- rollapply(zoo(EUR$curr_spot_rates_delta.EUR), width = w2, FUN = sd, na.rm = TRUE, align = "left")
rhm2$EUR_SME <- (rhm2$EUR_mean - subset(EUR$curr_spot_rates_delta.EUR, EUR$curr_spot_rates.Date > 198012))^2
CumRSME$EUR[2] <- sqrt(sum(rhm2$EUR_SME)/354)

rhm3$EUR_mean <- rollapply(zoo(EUR$curr_spot_rates_delta.EUR), width = w3, FUN = mean, na.rm = TRUE, align = "left")
rhm3$EUR_sd <- rollapply(zoo(EUR$curr_spot_rates_delta.EUR), width = w3, FUN = sd, na.rm = TRUE, align = "left")
rhm3$EUR_SME <- (rhm3$EUR_mean - subset(EUR$curr_spot_rates_delta.EUR, EUR$curr_spot_rates.Date > 198512))^2
CumRSME$EUR[3] <- sqrt(sum(rhm3$EUR_SME)/294)

rhm4$EUR_mean <- rollapply(zoo(EUR$curr_spot_rates_delta.EUR), width = w4, FUN = mean, na.rm = TRUE, align = "left")
rhm4$EUR_sd <- rollapply(zoo(EUR$curr_spot_rates_delta.EUR), width = w4, FUN = sd, na.rm = TRUE, align = "left")
rhm4$EUR_SME <- (rhm4$EUR_mean - subset(EUR$curr_spot_rates_delta.EUR, EUR$curr_spot_rates.Date > 199512))^2
CumRSME$EUR[4] <- sqrt(sum(rhm4$EUR_SME)/174)

rhm5$EUR_mean <- rollapply(zoo(EUR$curr_spot_rates_delta.EUR), width = w5, FUN = mean, na.rm = TRUE, align = "left")
rhm5$EUR_sd <- rollapply(zoo(EUR$curr_spot_rates_delta.EUR), width = w5, FUN = sd, na.rm = TRUE, align = "left")
rhm5$EUR_SME <- (rhm5$EUR_mean - subset(EUR$curr_spot_rates_delta.EUR, EUR$curr_spot_rates.Date > 199012))^2
CumRSME$EUR[5] <- sqrt(sum(rhm5$EUR_SME)/234)




rhm1$GBP_mean <- rollapply(zoo(GBP$curr_spot_rates_delta.GBP), width = w1, FUN = mean, na.rm = TRUE, align = "left")
rhm1$GBP_sd <- rollapply(zoo(GBP$curr_spot_rates_delta.GBP), width = w1, FUN = sd, na.rm = TRUE, align = "left")
rhm1$GBP_SME <- (rhm1$GBP_mean - subset(GBP$curr_spot_rates_delta.GBP, GBP$curr_spot_rates.Date > 197812))^2
CumRSME$GBP[1] <- sqrt(sum(rhm1$GBP_SME)/378)

rhm2$GBP_mean <- rollapply(zoo(GBP$curr_spot_rates_delta.GBP), width = w2, FUN = mean, na.rm = TRUE, align = "left")
rhm2$GBP_sd <- rollapply(zoo(GBP$curr_spot_rates_delta.GBP), width = w2, FUN = sd, na.rm = TRUE, align = "left")
rhm2$GBP_SME <- (rhm2$GBP_mean - subset(GBP$curr_spot_rates_delta.GBP, GBP$curr_spot_rates.Date > 198012))^2
CumRSME$GBP[2] <- sqrt(sum(rhm2$GBP_SME)/354)

rhm3$GBP_mean <- rollapply(zoo(GBP$curr_spot_rates_delta.GBP), width = w3, FUN = mean, na.rm = TRUE, align = "left")
rhm3$GBP_sd <- rollapply(zoo(GBP$curr_spot_rates_delta.GBP), width = w3, FUN = sd, na.rm = TRUE, align = "left")
rhm3$GBP_SME <- (rhm3$GBP_mean - subset(GBP$curr_spot_rates_delta.GBP, GBP$curr_spot_rates.Date > 198512))^2
CumRSME$GBP[3] <- sqrt(sum(rhm3$GBP_SME)/294)

rhm4$GBP_mean <- rollapply(zoo(GBP$curr_spot_rates_delta.GBP), width = w4, FUN = mean, na.rm = TRUE, align = "left")
rhm4$GBP_sd <- rollapply(zoo(GBP$curr_spot_rates_delta.GBP), width = w4, FUN = sd, na.rm = TRUE, align = "left")
rhm4$GBP_SME <- (rhm4$GBP_mean - subset(GBP$curr_spot_rates_delta.GBP, GBP$curr_spot_rates.Date > 199512))^2
CumRSME$GBP[4] <- sqrt(sum(rhm4$GBP_SME)/174)

rhm5$GBP_mean <- rollapply(zoo(GBP$curr_spot_rates_delta.GBP), width = w5, FUN = mean, na.rm = TRUE, align = "left")
rhm5$GBP_sd <- rollapply(zoo(GBP$curr_spot_rates_delta.GBP), width = w5, FUN = sd, na.rm = TRUE, align = "left")
rhm5$GBP_SME <- (rhm5$GBP_mean - subset(GBP$curr_spot_rates_delta.GBP, GBP$curr_spot_rates.Date > 199012))^2
CumRSME$GBP[5] <- sqrt(sum(rhm5$GBP_SME)/234)




rhm1$JPY_mean <- rollapply(zoo(JPY$curr_spot_rates_delta.JPY), width = w1, FUN = mean, na.rm = TRUE, align = "left")
rhm1$JPY_sd <- rollapply(zoo(JPY$curr_spot_rates_delta.JPY), width = w1, FUN = sd, na.rm = TRUE, align = "left")
rhm1$JPY_SME <- (rhm1$JPY_mean - subset(JPY$curr_spot_rates_delta.JPY, JPY$curr_spot_rates.Date > 197812))^2
CumRSME$JPY[1] <- sqrt(sum(rhm1$JPY_SME)/378)

rhm2$JPY_mean <- rollapply(zoo(JPY$curr_spot_rates_delta.JPY), width = w2, FUN = mean, na.rm = TRUE, align = "left")
rhm2$JPY_sd <- rollapply(zoo(JPY$curr_spot_rates_delta.JPY), width = w2, FUN = sd, na.rm = TRUE, align = "left")
rhm2$JPY_SME <- (rhm2$JPY_mean - subset(JPY$curr_spot_rates_delta.JPY, JPY$curr_spot_rates.Date > 198012))^2
CumRSME$JPY[2] <- sqrt(sum(rhm2$JPY_SME)/354)

rhm3$JPY_mean <- rollapply(zoo(JPY$curr_spot_rates_delta.JPY), width = w3, FUN = mean, na.rm = TRUE, align = "left")
rhm3$JPY_sd <- rollapply(zoo(JPY$curr_spot_rates_delta.JPY), width = w3, FUN = sd, na.rm = TRUE, align = "left")
rhm3$JPY_SME <- (rhm3$JPY_mean - subset(JPY$curr_spot_rates_delta.JPY, JPY$curr_spot_rates.Date > 198512))^2
CumRSME$JPY[3] <- sqrt(sum(rhm3$JPY_SME)/294)

rhm4$JPY_mean <- rollapply(zoo(JPY$curr_spot_rates_delta.JPY), width = w4, FUN = mean, na.rm = TRUE, align = "left")
rhm4$JPY_sd <- rollapply(zoo(JPY$curr_spot_rates_delta.JPY), width = w4, FUN = sd, na.rm = TRUE, align = "left")
rhm4$JPY_SME <- (rhm4$JPY_mean - subset(JPY$curr_spot_rates_delta.JPY, JPY$curr_spot_rates.Date > 199512))^2
CumRSME$JPY[4] <- sqrt(sum(rhm4$JPY_SME)/174)

rhm5$JPY_mean <- rollapply(zoo(JPY$curr_spot_rates_delta.JPY), width = w5, FUN = mean, na.rm = TRUE, align = "left")
rhm5$JPY_sd <- rollapply(zoo(JPY$curr_spot_rates_delta.JPY), width = w5, FUN = sd, na.rm = TRUE, align = "left")
rhm5$JPY_SME <- (rhm5$JPY_mean - subset(JPY$curr_spot_rates_delta.JPY, JPY$curr_spot_rates.Date > 199012))^2
CumRSME$JPY[5] <- sqrt(sum(rhm5$JPY_SME)/234)




rhm1$NOK_mean <- rollapply(zoo(NOK$curr_spot_rates_delta.NOK), width = w1, FUN = mean, na.rm = TRUE, align = "left")
rhm1$NOK_sd <- rollapply(zoo(NOK$curr_spot_rates_delta.NOK), width = w1, FUN = sd, na.rm = TRUE, align = "left")
rhm1$NOK_SME <- (rhm1$NOK_mean - subset(NOK$curr_spot_rates_delta.NOK, NOK$curr_spot_rates.Date > 197812))^2
CumRSME$NOK[1] <- sqrt(sum(rhm1$NOK_SME)/378)

rhm2$NOK_mean <- rollapply(zoo(NOK$curr_spot_rates_delta.NOK), width = w2, FUN = mean, na.rm = TRUE, align = "left")
rhm2$NOK_sd <- rollapply(zoo(NOK$curr_spot_rates_delta.NOK), width = w2, FUN = sd, na.rm = TRUE, align = "left")
rhm2$NOK_SME <- (rhm2$NOK_mean - subset(NOK$curr_spot_rates_delta.NOK, NOK$curr_spot_rates.Date > 198012))^2
CumRSME$NOK[2] <- sqrt(sum(rhm2$NOK_SME)/354)

rhm3$NOK_mean <- rollapply(zoo(NOK$curr_spot_rates_delta.NOK), width = w3, FUN = mean, na.rm = TRUE, align = "left")
rhm3$NOK_sd <- rollapply(zoo(NOK$curr_spot_rates_delta.NOK), width = w3, FUN = sd, na.rm = TRUE, align = "left")
rhm3$NOK_SME <- (rhm3$NOK_mean - subset(NOK$curr_spot_rates_delta.NOK, NOK$curr_spot_rates.Date > 198512))^2
CumRSME$NOK[3] <- sqrt(sum(rhm3$NOK_SME)/294)

rhm4$NOK_mean <- rollapply(zoo(NOK$curr_spot_rates_delta.NOK), width = w4, FUN = mean, na.rm = TRUE, align = "left")
rhm4$NOK_sd <- rollapply(zoo(NOK$curr_spot_rates_delta.NOK), width = w4, FUN = sd, na.rm = TRUE, align = "left")
rhm4$NOK_SME <- (rhm4$NOK_mean - subset(NOK$curr_spot_rates_delta.NOK, NOK$curr_spot_rates.Date > 199512))^2
CumRSME$NOK[4] <- sqrt(sum(rhm4$NOK_SME)/174)

rhm5$NOK_mean <- rollapply(zoo(NOK$curr_spot_rates_delta.NOK), width = w5, FUN = mean, na.rm = TRUE, align = "left")
rhm5$NOK_sd <- rollapply(zoo(NOK$curr_spot_rates_delta.NOK), width = w5, FUN = sd, na.rm = TRUE, align = "left")
rhm5$NOK_SME <- (rhm5$NOK_mean - subset(NOK$curr_spot_rates_delta.NOK, NOK$curr_spot_rates.Date > 199012))^2
CumRSME$NOK[5] <- sqrt(sum(rhm5$NOK_SME)/234)




rhm1$NZD_mean <- rollapply(zoo(NZD$curr_spot_rates_delta.NZD), width = w1, FUN = mean, na.rm = TRUE, align = "left")
rhm1$NZD_sd <- rollapply(zoo(NZD$curr_spot_rates_delta.NZD), width = w1, FUN = sd, na.rm = TRUE, align = "left")
rhm1$NZD_SME <- (rhm1$NZD_mean - subset(NZD$curr_spot_rates_delta.NZD, NZD$curr_spot_rates.Date > 197812))^2
CumRSME$NZD[1] <- sqrt(sum(rhm1$NZD_SME)/378)

rhm2$NZD_mean <- rollapply(zoo(NZD$curr_spot_rates_delta.NZD), width = w2, FUN = mean, na.rm = TRUE, align = "left")
rhm2$NZD_sd <- rollapply(zoo(NZD$curr_spot_rates_delta.NZD), width = w2, FUN = sd, na.rm = TRUE, align = "left")
rhm2$NZD_SME <- (rhm2$NZD_mean - subset(NZD$curr_spot_rates_delta.NZD, NZD$curr_spot_rates.Date > 198012))^2
CumRSME$NZD[2] <- sqrt(sum(rhm2$NZD_SME)/354)

rhm3$NZD_mean <- rollapply(zoo(NZD$curr_spot_rates_delta.NZD), width = w3, FUN = mean, na.rm = TRUE, align = "left")
rhm3$NZD_sd <- rollapply(zoo(NZD$curr_spot_rates_delta.NZD), width = w3, FUN = sd, na.rm = TRUE, align = "left")
rhm3$NZD_SME <- (rhm3$NZD_mean - subset(NZD$curr_spot_rates_delta.NZD, NZD$curr_spot_rates.Date > 198512))^2
CumRSME$NZD[3] <- sqrt(sum(rhm3$NZD_SME)/294)

rhm4$NZD_mean <- rollapply(zoo(NZD$curr_spot_rates_delta.NZD), width = w4, FUN = mean, na.rm = TRUE, align = "left")
rhm4$NZD_sd <- rollapply(zoo(NZD$curr_spot_rates_delta.NZD), width = w4, FUN = sd, na.rm = TRUE, align = "left")
rhm4$NZD_SME <- (rhm4$NZD_mean - subset(NZD$curr_spot_rates_delta.NZD, NZD$curr_spot_rates.Date > 199512))^2
CumRSME$NZD[4] <- sqrt(sum(rhm4$NZD_SME)/174)

rhm5$NZD_mean <- rollapply(zoo(NZD$curr_spot_rates_delta.NZD), width = w5, FUN = mean, na.rm = TRUE, align = "left")
rhm5$NZD_sd <- rollapply(zoo(NZD$curr_spot_rates_delta.NZD), width = w5, FUN = sd, na.rm = TRUE, align = "left")
rhm5$NZD_SME <- (rhm5$NZD_mean - subset(NZD$curr_spot_rates_delta.NZD, NZD$curr_spot_rates.Date > 199012))^2
CumRSME$NZD[5] <- sqrt(sum(rhm5$NZD_SME)/234)




rhm1$SEK_mean <- rollapply(zoo(SEK$curr_spot_rates_delta.SEK), width = w1, FUN = mean, na.rm = TRUE, align = "left")
rhm1$SEK_sd <- rollapply(zoo(SEK$curr_spot_rates_delta.SEK), width = w1, FUN = sd, na.rm = TRUE, align = "left")
rhm1$SEK_SME <- (rhm1$SEK_mean - subset(SEK$curr_spot_rates_delta.SEK, SEK$curr_spot_rates.Date > 197812))^2
CumRSME$SEK[1] <- sqrt(sum(rhm1$SEK_SME)/378)

rhm2$SEK_mean <- rollapply(zoo(SEK$curr_spot_rates_delta.SEK), width = w2, FUN = mean, na.rm = TRUE, align = "left")
rhm2$SEK_sd <- rollapply(zoo(SEK$curr_spot_rates_delta.SEK), width = w2, FUN = sd, na.rm = TRUE, align = "left")
rhm2$SEK_SME <- (rhm2$SEK_mean - subset(SEK$curr_spot_rates_delta.SEK, SEK$curr_spot_rates.Date > 198012))^2
CumRSME$SEK[2] <- sqrt(sum(rhm2$SEK_SME)/354)

rhm3$SEK_mean <- rollapply(zoo(SEK$curr_spot_rates_delta.SEK), width = w3, FUN = mean, na.rm = TRUE, align = "left")
rhm3$SEK_sd <- rollapply(zoo(SEK$curr_spot_rates_delta.SEK), width = w3, FUN = sd, na.rm = TRUE, align = "left")
rhm3$SEK_SME <- (rhm3$SEK_mean - subset(SEK$curr_spot_rates_delta.SEK, SEK$curr_spot_rates.Date > 198512))^2
CumRSME$SEK[3] <- sqrt(sum(rhm3$SEK_SME)/294)

rhm4$SEK_mean <- rollapply(zoo(SEK$curr_spot_rates_delta.SEK), width = w4, FUN = mean, na.rm = TRUE, align = "left")
rhm4$SEK_sd <- rollapply(zoo(SEK$curr_spot_rates_delta.SEK), width = w4, FUN = sd, na.rm = TRUE, align = "left")
rhm4$SEK_SME <- (rhm4$SEK_mean - subset(SEK$curr_spot_rates_delta.SEK, SEK$curr_spot_rates.Date > 199512))^2
CumRSME$SEK[4] <- sqrt(sum(rhm4$SEK_SME)/174)

rhm5$SEK_mean <- rollapply(zoo(SEK$curr_spot_rates_delta.SEK), width = w5, FUN = mean, na.rm = TRUE, align = "left")
rhm5$SEK_sd <- rollapply(zoo(SEK$curr_spot_rates_delta.SEK), width = w5, FUN = sd, na.rm = TRUE, align = "left")
rhm5$SEK_SME <- (rhm5$SEK_mean - subset(SEK$curr_spot_rates_delta.SEK, SEK$curr_spot_rates.Date > 199012))^2
CumRSME$SEK[5] <- sqrt(sum(rhm5$SEK_SME)/234)


rowMeans(CumRSME)


sharp_AUD15 <- (rhm5$AUD_mean - subset(risk_free_return$percent, risk_free_return$Date > 199012))/rhm5$AUD_sd

sharp_CAD15 <- (rhm5$CAD_mean - subset(risk_free_return$percent, risk_free_return$Date > 199012))/rhm5$CAD_sd

sharp_CHF15 <- (rhm5$CHF_mean - subset(risk_free_return$percent, risk_free_return$Date > 199012))/rhm5$CHF_sd

sharp_EUR15 <- (rhm5$EUR_mean - subset(risk_free_return$percent, risk_free_return$Date > 199012))/rhm5$EUR_sd

sharp_GBP15 <- (rhm5$GBP_mean - subset(risk_free_return$percent, risk_free_return$Date > 199012))/rhm5$GBP_sd

sharp_JPY15 <- (rhm5$JPY_mean - subset(risk_free_return$percent, risk_free_return$Date > 199012))/rhm5$JPY_sd

sharp_NOK15 <- (rhm5$NOK_mean - subset(risk_free_return$percent, risk_free_return$Date > 199012))/rhm5$NOK_sd

sharp_NZD15 <- (rhm5$NZD_mean - subset(risk_free_return$percent, risk_free_return$Date > 199012))/rhm5$NZD_sd

sharp_SEK15 <- (rhm5$SEK_mean - subset(risk_free_return$percent, risk_free_return$Date > 199012))/rhm5$SEK_sd


#Kitchen Sink regression (Elastic Net)
train_control <- trainControl(method="LOOCV")

enet <- data.frame(row.names = 1:234)


for (i in seq(w5, nrow(AUD))){
   temp <- train(x = AUD[(i-(w5-1)):i, 4:10], y = AUD[(i-(w5-1)):i , 3], method = "enet", metric = "RMSE", maximize = FALSE, trControl = train_control)
  enet[(i-(w5-1)), "AUD"] <- predict(temp, newdata = AUD[i, 4:10])
}

for (i in seq(w5, nrow(CAD))){
   temp <- train(x = CAD[(i-(w5-1)):i, 4:10], y = CAD[(i-(w5-1)):i , 3], method = "enet", metric = "RMSE", maximize = FALSE, trControl = train_control)
  enet[(i-(w5-1)), "CAD"] <- predict(temp, newdata = CAD[i, 4:10])
}

for (i in seq(w5, nrow(CHF))){
   temp <- train(x = CHF[(i-(w5-1)):i, 4:10], y = CHF[(i-(w5-1)):i , 3], method = "enet", metric = "RMSE", maximize = FALSE, trControl = train_control)
  enet[(i-(w5-1)), "CHF"] <- predict(temp, newdata = CHF[i, 4:10])
}

for (i in seq(w5, nrow(EUR))){
   temp <- train(x = EUR[(i-(w5-1)):i, 4:10], y = EUR[(i-(w5-1)):i , 3], method = "enet", metric = "RMSE", maximize = FALSE, trControl = train_control)
  enet[(i-(w5-1)), "EUR"] <- predict(temp, newdata = EUR[i, 4:10])
}

for (i in seq(w5, nrow(GBP))){
   temp <- train(x = GBP[(i-(w5-1)):i, 4:10], y = GBP[(i-(w5-1)):i , 3], method = "enet", metric = "RMSE", maximize = FALSE, trControl = train_control)
  enet[(i-(w5-1)), "GBP"] <- predict(temp, newdata = GBP[i, 4:10])
}

for (i in seq(w5, nrow(JPY))){
   temp <- train(x = JPY[(i-(w5-1)):i, 4:10], y = JPY[(i-(w5-1)):i , 3], method = "enet", metric = "RMSE", maximize = FALSE, trControl = train_control)
  enet[(i-(w5-1)), "JPY"] <- predict(temp, newdata = JPY[i, 4:10])
}

for (i in seq(w5, nrow(NOK))){
   temp <- train(x = NOK[(i-(w5-1)):i, 4:10], y = NOK[(i-(w5-1)):i , 3], method = "enet", metric = "RMSE", maximize = FALSE, trControl = train_control)
  enet[(i-(w5-1)), "NOK"] <- predict(temp, newdata = NOK[i, 4:10])
}

for (i in seq(w5, nrow(NZD))){
   temp <- train(x = NZD[(i-(w5-1)):i, 4:10], y = NZD[(i-(w5-1)):i , 3], method = "enet", metric = "RMSE", maximize = FALSE, trControl = train_control)
  enet[(i-(w5-1)), "NZD"] <- predict(temp, newdata = NZD[i, 4:10])
}

for (i in seq(w5, nrow(SEK))){
   temp <- train(x = SEK[(i-(w5-1)):i, 4:10], y = SEK[(i-(w5-1)):i , 3], method = "enet", metric = "RMSE", maximize = FALSE, trControl = train_control)
  enet[(i-(w5-1)), "SEK"] <- predict(temp, newdata = SEK[i, 4:10])
}


enet$AUD_SMR <- (enet$AUD - subset(AUD$curr_spot_rates_delta.AUD, AUD$curr_spot_rates.Date > 199012))^2
enet$CAD_SMR <- (enet$CAD - subset(CAD$curr_spot_rates_delta.CAD, CAD$curr_spot_rates.Date > 199012))^2
enet$CHF_SMR <- (enet$CHF - subset(CHF$curr_spot_rates_delta.CHF, CHF$curr_spot_rates.Date > 199012))^2
enet$EUR_SMR <- (enet$EUR - subset(EUR$curr_spot_rates_delta.EUR, EUR$curr_spot_rates.Date > 199012))^2
enet$GBP_SMR <- (enet$GBP - subset(GBP$curr_spot_rates_delta.GBP, GBP$curr_spot_rates.Date > 199012))^2
enet$JPY_SMR <- (enet$JPY - subset(JPY$curr_spot_rates_delta.JPY, JPY$curr_spot_rates.Date > 199012))^2
enet$NOK_SMR <- (enet$NOK - subset(NOK$curr_spot_rates_delta.NOK, NOK$curr_spot_rates.Date > 199012))^2
enet$NZD_SMR <- (enet$NZD - subset(NZD$curr_spot_rates_delta.NZD, NZD$curr_spot_rates.Date > 199012))^2
enet$SEK_SMR <- (enet$SEK - subset(SEK$curr_spot_rates_delta.SEK, SEK$curr_spot_rates.Date > 199012))^2

write.csv(x = enet, file = "enet.csv", row.names = FALSE)
enet <- read_excel("enet.xlsx")

RMSE_enet.AUD <- sqrt((sum(enet$AUD_SMR)/nrow(enet)))
RMSE_enet.CAD <- sqrt((sum(enet$CAD_SMR)/nrow(enet)))
RMSE_enet.CHF <- sqrt((sum(enet$CHF_SMR)/nrow(enet)))
RMSE_enet.EUR <- sqrt((sum(enet$EUR_SMR)/nrow(enet)))
RMSE_enet.GBP <- sqrt((sum(enet$GBP_SMR)/nrow(enet)))
RMSE_enet.JPY <- sqrt((sum(enet$JPY_SMR)/nrow(enet)))
RMSE_enet.NOK <- sqrt((sum(enet$NOK_SMR)/nrow(enet)))
RMSE_enet.NZD <- sqrt((sum(enet$NZD_SMR)/nrow(enet)))
RMSE_enet.SEK <- sqrt((sum(enet$SEK_SMR)/nrow(enet)))



difference.enet <- data.frame(row.names = 1:234)
difference.enet$AUD <- cumsum(enet$AUD_SMR - rhm5$AUD_SME)
difference.enet$CAD <- cumsum(enet$CAD_SMR - rhm5$CAD_SME)
difference.enet$CHF <- cumsum(enet$CHF_SMR - rhm5$CHF_SME)
difference.enet$EUR <- cumsum(enet$EUR_SMR - rhm5$EUR_SME)
difference.enet$GBP <- cumsum(enet$GBP_SMR - rhm5$GBP_SME)
difference.enet$JPY <- cumsum(enet$JPY_SMR - rhm5$JPY_SME)
difference.enet$NOK <- cumsum(enet$NOK_SMR - rhm5$NOK_SME)
difference.enet$NZD <- cumsum(enet$NZD_SMR - rhm5$NZD_SME)
difference.enet$SEK <- cumsum(enet$SEK_SMR - rhm5$SEK_SME)

plot(difference.enet$AUD)
plot(difference.enet$CAD)
plot(difference.enet$CHF)
plot(difference.enet$EUR)
plot(difference.enet$GBP)
plot(difference.enet$JPY)
plot(difference.enet$NOK)
plot(difference.enet$NZD)
plot(difference.enet$SEK)


#Random Forest

rf <- data.frame(row.names = 1:234)


for (i in seq(w5, nrow(AUD))){
   temp <- train(x = AUD[(i-(w5-1)):i, 4:10], y = AUD[(i-(w5-1)):i , 3], method = "rf", metric = "RMSE", maximize = FALSE, trControl = train_control)
  rf[(i-(w5-1)), "AUD"] <- predict(temp, newdata = AUD[i, 4:10])
}

for (i in seq(w5, nrow(CAD))){
   temp <- train(x = CAD[(i-(w5-1)):i, 4:10], y = CAD[(i-(w5-1)):i , 3], method = "rf", metric = "RMSE", maximize = FALSE, trControl = train_control)
  rf[(i-(w5-1)), "CAD"] <- predict(temp, newdata = CAD[i, 4:10])
}

for (i in seq(w5, nrow(CHF))){
   temp <- train(x = CHF[(i-(w5-1)):i, 4:10], y = CHF[(i-(w5-1)):i , 3], method = "rf", metric = "RMSE", maximize = FALSE, trControl = train_control)
  rf[(i-(w5-1)), "CHF"] <- predict(temp, newdata = CHF[i, 4:10])
}

for (i in seq(w5, nrow(EUR))){
   temp <- train(x = EUR[(i-(w5-1)):i, 4:10], y = EUR[(i-(w5-1)):i , 3], method = "rf", metric = "RMSE", maximize = FALSE, trControl = train_control)
  rf[(i-(w5-1)), "EUR"] <- predict(temp, newdata = EUR[i, 4:10])
}

for (i in seq(w5, nrow(GBP))){
   temp <- train(x = GBP[(i-(w5-1)):i, 4:10], y = GBP[(i-(w5-1)):i , 3], method = "rf", metric = "RMSE", maximize = FALSE, trControl = train_control)
  rf[(i-(w5-1)), "GBP"] <- predict(temp, newdata = GBP[i, 4:10])
}

for (i in seq(w5, nrow(JPY))){
   temp <- train(x = JPY[(i-(w5-1)):i, 4:10], y = JPY[(i-(w5-1)):i , 3], method = "rf", metric = "RMSE", maximize = FALSE, trControl = train_control)
  rf[(i-(w5-1)), "JPY"] <- predict(temp, newdata = JPY[i, 4:10])
}

for (i in seq(w5, nrow(NOK))){
   temp <- train(x = NOK[(i-(w5-1)):i, 4:10], y = NOK[(i-(w5-1)):i , 3], method = "rf", metric = "RMSE", maximize = FALSE, trControl = train_control)
  rf[(i-(w5-1)), "NOK"] <- predict(temp, newdata = NOK[i, 4:10])
}

for (i in seq(w5, nrow(NZD))){
   temp <- train(x = NZD[(i-(w5-1)):i, 4:10], y = NZD[(i-(w5-1)):i , 3], method = "rf", metric = "RMSE", maximize = FALSE, trControl = train_control)
  rf[(i-(w5-1)), "NZD"] <- predict(temp, newdata = NZD[i, 4:10])
}

for (i in seq(w5, nrow(SEK))){
   temp <- train(x = SEK[(i-(w5-1)):i, 4:10], y = SEK[(i-(w5-1)):i , 3], method = "rf", metric = "RMSE", maximize = FALSE, trControl = train_control)
  rf[(i-(w5-1)), "SEK"] <- predict(temp, newdata = SEK[i, 4:10])
}


rf$AUD_SMR <- (rf$AUD - subset(AUD$curr_spot_rates_delta.AUD, AUD$curr_spot_rates.Date > 199012))^2
rf$CAD_SMR <- (rf$CAD - subset(CAD$curr_spot_rates_delta.CAD, CAD$curr_spot_rates.Date > 199012))^2
rf$CHF_SMR <- (rf$CHF - subset(CHF$curr_spot_rates_delta.CHF, CHF$curr_spot_rates.Date > 199012))^2
rf$EUR_SMR <- (rf$EUR - subset(EUR$curr_spot_rates_delta.EUR, EUR$curr_spot_rates.Date > 199012))^2
rf$GBP_SMR <- (rf$GBP - subset(GBP$curr_spot_rates_delta.GBP, GBP$curr_spot_rates.Date > 199012))^2
rf$JPY_SMR <- (rf$JPY - subset(JPY$curr_spot_rates_delta.JPY, JPY$curr_spot_rates.Date > 199012))^2
rf$NOK_SMR <- (rf$NOK - subset(NOK$curr_spot_rates_delta.NOK, NOK$curr_spot_rates.Date > 199012))^2
rf$NZD_SMR <- (rf$NZD - subset(NZD$curr_spot_rates_delta.NZD, NZD$curr_spot_rates.Date > 199012))^2
rf$SEK_SMR <- (rf$SEK - subset(SEK$curr_spot_rates_delta.SEK, SEK$curr_spot_rates.Date > 199012))^2


write.csv(x = rf, file = "rf.csv", row.names = FALSE)

RMSE_rf.AUD <- sqrt((sum(rf$AUD_SMR)/nrow(rf)))
RMSE_rf.CAD <- sqrt((sum(rf$CAD_SMR)/nrow(rf)))
RMSE_rf.CHF <- sqrt((sum(rf$CHF_SMR)/nrow(rf)))
RMSE_rf.EUR <- sqrt((sum(rf$EUR_SMR)/nrow(rf)))
RMSE_rf.GBP <- sqrt((sum(rf$GBP_SMR)/nrow(rf)))
RMSE_rf.JPY <- sqrt((sum(rf$JPY_SMR)/nrow(rf)))
RMSE_rf.NOK <- sqrt((sum(rf$NOK_SMR)/nrow(rf)))
RMSE_rf.NZD <- sqrt((sum(rf$NZD_SMR)/nrow(rf)))
RMSE_rf.SEK <- sqrt((sum(rf$SEK_SMR)/nrow(rf)))



difference.rf <- data.frame(row.names = 1:234)
difference.rf$AUD <- cumsum(rf$AUD_SMR - rhm5$AUD_SME)
difference.rf$CAD <- cumsum(rf$CAD_SMR - rhm5$CAD_SME)
difference.rf$CHF <- cumsum(rf$CHF_SMR - rhm5$CHF_SME)
difference.rf$EUR <- cumsum(rf$EUR_SMR - rhm5$EUR_SME)
difference.rf$GBP <- cumsum(rf$GBP_SMR - rhm5$GBP_SME)
difference.rf$JPY <- cumsum(rf$JPY_SMR - rhm5$JPY_SME)
difference.rf$NOK <- cumsum(rf$NOK_SMR - rhm5$NOK_SME)
difference.rf$NZD <- cumsum(rf$NZD_SMR - rhm5$NZD_SME)
difference.rf$SEK <- cumsum(rf$SEK_SMR - rhm5$SEK_SME)

plot(difference.rf$AUD)
plot(difference.rf$CAD)
plot(difference.rf$CHF)
plot(difference.rf$EUR)
plot(difference.rf$GBP)
plot(difference.rf$JPY)
plot(difference.rf$NOK)
plot(difference.rf$NZD)
plot(difference.rf$SEK)

```

